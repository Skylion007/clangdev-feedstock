From 84ce88cf0a9a24bb0b59110827c73b3978788caf Mon Sep 17 00:00:00 2001
From: Philippe Canal <pcanal@fnal.gov>
Date: Wed, 23 Sep 2015 09:34:32 +0200
Subject: [PATCH 071/110] Add ASTConsumer::HandleInvalidTagDeclDefinition.

This allows Sema to inform the consumer that an invalid declaration has been seen and
can properly react (for example an interpreter may want to revert the transaction)
---
 include/clang/Frontend/MultiplexConsumer.h | 1 +
 lib/Frontend/MultiplexConsumer.cpp         | 5 +++++
 2 files changed, 6 insertions(+)

diff --git a/include/clang/Frontend/MultiplexConsumer.h b/include/clang/Frontend/MultiplexConsumer.h
index ca6ed8310a..f8b9190a11 100644
--- a/include/clang/Frontend/MultiplexConsumer.h
+++ b/include/clang/Frontend/MultiplexConsumer.h
@@ -64,6 +64,7 @@ public:
   void HandleCXXImplicitFunctionInstantiation(FunctionDecl *D) override;
   void HandleTopLevelDeclInObjCContainer(DeclGroupRef D) override;
   void HandleImplicitImportDecl(ImportDecl *D) override;
+  void HandleInvalidTagDeclDefinition(TagDecl *D) override;
   void CompleteTentativeDefinition(VarDecl *D) override;
   void AssignInheritanceModel(CXXRecordDecl *RD) override;
   void HandleVTable(CXXRecordDecl *RD) override;
diff --git a/lib/Frontend/MultiplexConsumer.cpp b/lib/Frontend/MultiplexConsumer.cpp
index ed7028769d..e555358ed5 100644
--- a/lib/Frontend/MultiplexConsumer.cpp
+++ b/lib/Frontend/MultiplexConsumer.cpp
@@ -317,6 +317,11 @@ void MultiplexConsumer::HandleImplicitImportDecl(ImportDecl *D) {
     Consumer->HandleImplicitImportDecl(D);
 }
 
+void MultiplexConsumer::HandleInvalidTagDeclDefinition(TagDecl *D) {
+  for (auto &Consumer : Consumers)
+    Consumer->HandleInvalidTagDeclDefinition(D);
+}
+
 void MultiplexConsumer::CompleteTentativeDefinition(VarDecl *D) {
   for (auto &Consumer : Consumers)
     Consumer->CompleteTentativeDefinition(D);
-- 
2.29.2

